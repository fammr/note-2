# [tcp报文格式](http://www.cnblogs.com/xinyuyuanm/archive/2013/04/17/3026279.html)

![](https://github.com/walmt/interview_questions/blob/master/%E8%AE%A1%E7%BD%91/img/1.jpg)

- 源端口（Source Port）：
  - 16位的源端口字段包含初始化通信的端口号。源端口和IP地址的作用是标识报文的返回地址。
- 目的端口(Destination Port)：
  - 16位的目的端口字段定义传输的目的。这个端口指明接收方计算机上的应用程序接口。
- 序列号（Sequence Number）：
  - 该字段用来标识TCP源端设备向目的端设备发送的字节流，它表示在这个报文段中的第几个数据字节。序列号是一个32位的数。
- 确认号（Acknowledge Number）：
  - TCP使用32位的确认号字段标识期望收到的下一个段的第一个字节，并声明此前的所有数据已经正确无误地收到，因此，确认号应该是上次已成功收到的数据字节序列号加1。
  - 收到确认号的源计算机会知道特定的段已经被收到。确认号的字段只在ACK标志被设置时才有效。
- 数据偏移（Data Offset）：
  - 这个4位字段包括TCP头大小。由于首部可能含有选项内容，因此TCP首部的长度是不确定的。首部长度的单位是32比特或4个八位组。首部长度实际上也指示了数据区在报文段中的起始偏移值。
- 保留（Reserved）：
  - 6位置0的字段。为将来定义新的用途保留。
- 控制位(Control Bits)：共6位，每一位标志可以打开一个控制功能。
  - URG(Urgent Pointer Field Significant,紧急指针字段标志)：
    - 表示TCP包的紧急指针字段有效，用来保证TCP连接不被中断，并且督促中间齐备尽快处理这些数据。
  - ACK（Acknowledgement field significant,确认字段标志）: 
    - 取1时表示应答字段有效，也即TCP应答号将包含在TCP段中，为0则反之。
  - PSH(Push Function,推功能)：
    - 这个标志表示Push操作。所谓Push操作就是指在数据包到达接收端以后，立即送给应用程序，而不是在缓冲区中排队。
  - RST（Reset the connection,重置连接）：
    - 这个标志表示感谢连接复位请求，用来复位那些产生错误的连接，也被用来拒绝错误和非法的数据包。
  - SYN（Synchronize sequence numbers,同步序列号）：
    - 表示同步序号，用来建立连接。
  - FIN（No more data from sender）：
    - 表示发送端已经发送到数据末尾，数据传送完成，发送FIN标志位的TCP段，连接将被断开。
- 窗口（Window）：
  - 目的主机使用16位的窗口字段告诉源主机它期望每次收到的数据通的字节数。
- 校验和（Checksum）：
  - TCP头包括16位的校验和字段用于错误检查。源主机基于部分IP头信息，TCP头和数据内容计算一个校验和，目的主机也要进行相同的计算，如果收到的内容没有错误过，两个计算应该完全一样，从而证明数据的有效性。
- 紧急指针（Urgent Pointer）：
  - 紧急指针字段是一个可选的16位指针，指向段内的最后一个字节位置，这个字段只在URG标志被设置时才有效。
- 选项（Option）：
  - 至少1字节的可变长字段，标识哪个选项（如果有的话）有效。如果没有选项，这个字节等于0,说明选项的结束。这个字节等于1表示无需再有操作；等于2表示下四个字节包括源机器的最大长度（Maximum Segment Size,MSS）。
- 填充（Padding）：
  - 这个字段中加入额外的零，以保证TCP头是32的整数倍。